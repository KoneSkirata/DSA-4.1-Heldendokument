<!doctype html>
<html lang="de" style="background-color: darkslategray;">
  <head>
  <title>DSA 4.1 Heldendokument: Installation &amp; Bedienung</title>
  <link rel="stylesheet" href="style.css"/>
  </head>
  <body>
  <nav>
    <ul>
    <li><a href="index.html">Home</a></li>
    <li><a href="manual.html">Installation &amp; Bedienung</a></li>
    <li><a href="format.html">Formatspezifikation</a></li>
    <li><a href="imprint.html">Impressum</a></li>
    <li><a href="https://github.com/flyx/DSA-4.1-Heldendokument"><img src="GitHub-Mark-Light-32px.png" srcset="GitHub-Mark-Light-64px.png 2x" style="height: .8em;"/> Github</a></li>
    </ul>
  </nav>
  <article class="doc">
    <section>
      <h1>DSA 4.1 Heldendokument: Installation &amp; Bedienung</h1>
      <p>Der Generator des Heldendokuments unterstützt <strong>macOS</strong> und <strong>Linux</strong>.
         Das Webinterface lässt sich in einem Docker-Container auch unter <strong>Windows</strong> betreiben.
         Um den Generator auf der Kommandozeile zu benutzen, müssen Windows-Nutzer auf WSL zurückgreifen, was hier nicht erläutert wird.</p>
      
      <p>Der Generator benutzt verschiedene Werke, die zwar kostenlos aus dem Internet geladen werden können, deren Lizenz aber keine Weiterverbreitung erlaubt.
      Aus diesem Grund kann der fertige Generator nicht zum Download angeboten werden.
      Statt dessen wird ein Script zur Verfügung gestellt, mit dem du den Generator vollautomatisch auf deinem PC bauen kannst.
      Das Script lädt alle relevanten Dateien aus dem Internet und erstellt dir daraus den Generator.</p>
    </section>
    
    <section>
      <h2>Generator auf der Kommandozeile</h2>
      
      <p>Der Generator selbst ist ein Script, das sich von der Kommandozeile aus ausführen lässt.
         Wenn du die Kommandozeile nicht gewohnt bist oder generell lieber ein Webinterface haben willst, überspringe diesen Abschnitt einfach und installiere statt dessen das Webinterface.</p>
      
      <h3>Installation</h3>
      
      <p>Du benötigst Nix auf deinem System; dies ist ein Paketmanager, der die Abhängigkeiten des Generators verwaltet und den Generator erstellt.
         Um Nix zu installieren, sei auf die <a href="https://nixos.org/guides/install-nix.html">offizielle Anleitung</a> verwiesen.</p>
      <p>Der Generator benutzt die experimentellen <a href="https://nixos.wiki/wiki/Flakes">Nix Flakes</a>.
         Auf der verlinkten Seite ist beschrieben, was zu tun ist, um dieses Feature in einer Nix-Installation zu aktivieren.</p>
      
      <p>Hast du Nix Flakes aktiviert, führe folgenden Befehl aus:</p>
      
      <pre><code>nix build github:flyx/DSA-4.1-Heldendokument#dsa41held</code></pre>
      
      <p>Dies erzeugt einen Ordner <code>result</code> (der tatsächlich ein symlink ist), in dem sich der Generator unter <code>bin/dsa41held</code> befindet.
         Du kannst das Paket natürlich wie gewohnt in dein System installieren, wenn du ohnehin Nix/NixOS benutzt.
         Alternativ kannst du das <code>bin</code>-Verzeichnis (nach Auflösung des symlinks) in deinen <code>PATH</code> hinzufügen, um den Generator einfach aufrufen zu können.</p>
      
      <h3>Benutzung</h3>
      
      <h4>PDF-Generierung</h4>
      
      <p>Die PDF-Generierung ist als Unterkommando verfügbar:</p>
      
      <pre><code>dsa41held pdf [-w] &lt;heldendatei&gt;</code></pre>
      
      <p>Gib <code>-w</code> an, um weißen Hintergrund zu bekommen.
         Die Heldendatei muss eine Lua-Datei sein, die dem <a href="format.html">Formatspezifikation</a> genügt.
         Die Erstellung eines PDFs dauert etwas länger (auf meinem System – MBP M1 Pro 32GB – etwa 18 Sekunden).
         Wer statt der enormen LuaLaTeX-Ausgabe lieber einen Fortschrittsbalken haben möchte, sollte das Webinterface benutzen.</p>
      
      <h4>Steigerung</h4>
      
      <p>Du kannst im Heldendokument <a href="format.html#Ereignisse">Steigerungsereignisse</a> angeben.
         Diese werden auf die angegebenen Anfangswerte appliziert bei der Erstellung des PDFs.
         Die Ereignisse berechnen ihre AP-Kosten großteils automatisch, sprich du hast bei der Eingabe keinen direkten Indikator, wie viele AP du noch übrig hast.</p>
      
      <p>Im erstellten PDF steht es nachher natürlich, aber weil das etwas braucht, gibt es ein Kommando, das dir auf der Kommandozeile die Steigerungsereignisse mit laufenden AP-Kosten ausgibt:</p>
      
      <pre><code>dsa41held ereignisse &lt;heldendatei&gt;</code></pre>
      
      <p>In der letzten Spalte stehen die übrigen AP nach jedem Ereignis.</p>
      
      <h4>Heldensoftware-Import</h4>
      
      <p>Du musst den Helden aus der Heldensoftware als XML-Datei exportieren.
         Danach kannst du ihn folgendermaßen importieren:</p>
      
      <pre><code>dsa41held import held.xml > held.lua</code></pre>
      
      <p>Dies erzeugt eine Datei <code>held.lua</code>, welche der Formatspezifikation genügt.
         Du kannst sie manuell editieren, bevor du daraus ein PDF erzeugst.
         Der Import importiert den aktuellen Stand des Helden als „Basisdaten“, hast du den Held in der Software gesteigert, sind diese Steigerungen fest eingerechnet und nicht als Steigerungsereignisse verfügbar.</p>
    </section>
  
    <section>
      <h2>Webinterface</h2>
      
      <p>Das Webinterface bietet eine einfache Möglichkeit, den Generator einmal zu installieren und der ganzen Rollenspielgruppe zur Verfügung zu stellen.
         Außerdem ist es mit Abstand die einfachste Möglichkeit, den Generator auf Windows zu betreiben.</p>
      
      <h3>Installation</h3>
      
      <p>Zunächst musst du <a href="https://www.docker.com/get-started">Docker Desktop</a> installieren (sofern du es nicht ohnehin auf deinem System hast).
         Starte Docker nach der Installation.
         (Linux-Nutzer können statt dessen <a href="https://podman.io">podman</a> benutzen, wenn sie sich damit auskennen – hier muss kein Service laufen.)</p>
      <p>Lade das <a href="https://github.com/flyx/DSA-4.1-Heldendokument/archive/refs/heads/master.zip">aktuelle zip-Archiv</a> des Projekts herunter, entpacke es, öffne eine Kommandozeile und wechsle in den entpackten Ordner.
         Führe dort folgende Befehle aus:</p>
      <pre>
        <code>
docker build -f build.dockerfile -t dsa41held-build .
docker run --rm dsa41held-build:latest > dsa41held-webui.tar
docker load -i dsa41held-webui.tar
        </code>
      </pre>
      <p>Der erste Befehl baut ein Docker-Image, das die Werkzeuge bereit stellt, die benötigt werden, um den Generator zu bauen.
         Der zweite Befehl baut den Generator und braucht dafür mehrere Minuten – es mag so aussehen als ob er hängen bleibt, aber das ist nicht der Fall!
         Warte einfach, bis der Befehl fertig ist.
         Mit dem dritten Befehl installierst du das <emph>image</emph>, in dem der Generator installiert ist, in Docker und kannst es damit zukünftig ausführen.</p>

      <h3>Benutzung</h3>
      <p>Das generierte Docker-Image kann folgendermaßen von der Kommandozeile aus gestartet werden, wenn Docker läuft (man muss in der Kommandozeile nicht zu einem Ordner navigieren):</p>
      <pre><code>docker run -p 80:80 --rm dsa41held-webui:latest</code></pre>
      <p>Solange dieser Befehl läuft, kann das Webinterface im Browser über die URL <a href="http://localhost/">http://localhost/</a> aufgerufen werden.
      Um das Webinterface zu beenden, drücke in der Konsole Ctrl+C.</p>
      <p>Das Webinterface ist minimal und dafür gedacht, den Inhalt der Helden-Datei ins Textfeld einzufügen und dann abzusenden. Es eignet sich nicht als Editor und speichert die Eingabe nicht ab. Die Generierung kann mehrere Minuten dauern, ein simpler Fortschrittsbalken wird währenddessen angezeigt. Das Webinterface inkludiert die Option, einen Held aus der Heldensoftware zu importieren.</p>
      
      <h3>Installation auf NixOS</h3>
      
      <p>NixOS-Nutzer, die das Webinterface als Service laufen lassen wollen, können einfach aus der Flake dieses Repositories das Modul <code>nixosModules.webui</code> importieren und dann in ihrer Konfiguration folgendes angeben:</p>
      
      <pre><code>services.dsa41generator = {
    enable = true;
    address = "127.0.0.1:8080";
  };</code></pre>
  
      <p>Für Remote-Erreichbarkeit muss die public IP angegeben und der Port in der Firewall freigeschaltet werden!</p>
    </section>
  </article>
  </body>
</html>